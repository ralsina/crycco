<!DOCTYPE html>

<html lang="en" data-theme="dark">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>collection.cr</title>
    <!-- Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Chivo+Mono:ital,wght@0,100..900;1,100..900&family=Chivo:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet">
    <!-- Pico CSS -->
    <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@latest/css/pico.min.css" />
    <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@latest/css/pico.colors.min.css" />
    <!-- Highlight.js -->
    <link id="hljscss" rel="stylesheet"
        href="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/styles/night-owl.min.css" />
    <script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/highlight.min.js"></script>
    <script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/languages/crystal.min.js"></script>
    <!-- Custom style-->
    
<style>
html * {
    font-family: Chivo, sans-serif;
    font-variant-ligatures: none;
    font-weight: 300;
    overflow: visible !important;
}

code,
code>* {
    font-family: 'Chivo Mono', monospace !important;
    padding-top: 0 !important;
}

div.doc>pre>code {
    background-color: var(--pico-color-slate-800);
    border: solid 1 var(--pico-color-slate-700)
}

.background {
    background: linear-gradient(to right, var(--pico-color-slate-900) 50%, #011627 50%);
    height: 100vh;
    width: 100vw;
    position: fixed;
    z-index: -1;
    margin: 0;
    top: 0px;
    left: 0px;
    display: block;
}
@media screen and (max-width: 768px) {
    div.background {
        display: none;
    }
}

span.anchor {
    position: relative;
}

a.anchor {
    position: absolute;
    text-decoration: none;
    left: -1.2em;
    opacity: 0;
    -webkit-transition: opacity 0.2s linear;
    
}

div.doc:hover .anchor {
    opacity: 1;
}

</style>

    <style>
        .sidebar {
            position: fixed;
            width: 240px;
            left: -240px;
            height: 100%;
            background: #1e1e1e;
            transition: all .5s ease;
        }

        .sidebar a {
            display: block;
            height: 65px;
            width: 100%;
            color: white;
            line-height: 65px;
            padding-left: 30px;
            box-sizing: border-box;
            border-bottom: 1px solid black;
            border-top: 1px solid rgba(255, 255, 255, .1);
            border-left: 5px solid transparent;
            font-family: 'Open Sans', sans-serif;
            transition: all .5s ease;
        }

        a.active,
        a:hover {
            border-left: 5px solid #b93632;
            color: #b93632;
        }

        #check {
            
        }

        #check:checked~.sidebar {
            left: 0;
        }

        #check:checked~label #btn {
            margin-left: 245px;
            opacity: 0;
            visibility: hidden;
        }

        #check:checked~label #cancel {
            margin-left: 245px;
            opacity: 1;
            visibility: visible;
        }
    </style>
</head>

<body>
    <input type="checkbox" id="check">
    <div class="sidebar">
        
        <a href="languages.yml.html"><span>languages.yml</span></a></li>
        
        <a href="collection.cr.html"><span>collection.cr</span></a></li>
        
        <a href="crycco.cr.html"><span>crycco.cr</span></a></li>
        
        <a href="main.cr.html"><span>main.cr</span></a></li>
        
        <a href="templates.cr.html"><span>templates.cr</span></a></li>
        
    </div>

    <main class="container">
        
<div id="background" class="background">
</div>

<div id="section-1" class="grid">
    <div class="doc" id="section-1">
        <span class="anchor">
            <a href="#section-1" class="anchor">↦</a>
        </span>
        <h1>collection.cr</h1>
<p>A Collection is a group of sources that will be processed together
and saved to the same output directory while preserving the directory
structure of the sources.</p>
<p>This way the logic for path manipulation is centrallized here and
the Document class can be simpler.</p>

    </div>
    <div class="code">
        <pre class="code"><code class="crystal">require &quot;./crycco&quot;

module Crycco
  class Collection
    @docs : Array(Document)

</code></pre>
    </div>
</div>

<div id="section-2" class="grid">
    <div class="doc" id="section-2">
        <span class="anchor">
            <a href="#section-2" class="anchor">↦</a>
        </span>
        <p>On initialization, we create documents for each source file</p>

    </div>
    <div class="code">
        <pre class="code"><code class="crystal">    def initialize(sources : Array(String), out_dir : String, template : String, as_source : Bool)
      @docs = sources.map { |source|
        Path[source].expand.normalize
      }.map { |source|
        Document.new source, template, as_source
      }

      @out_dir = out_dir
      @template = template
      @template = &quot;source&quot; if as_source
      @as_source = as_source
      @base_dir = Path[common_prefix]
    end

</code></pre>
    </div>
</div>

<div id="section-3" class="grid">
    <div class="doc" id="section-3">
        <span class="anchor">
            <a href="#section-3" class="anchor">↦</a>
        </span>
        <p>Save the documents to the output directory.</p>
<p>As extra context for rendering, we pass links to all
the documents in the collection.</p>

    </div>
    <div class="code">
        <pre class="code"><code class="crystal">    def save
      links = {} of String =&gt; String
      @docs.each do |doc|
        links[doc.path.relative_to(@base_dir).to_s] = dst_path(doc).relative_to(@out_dir).to_s
      end
      @docs.each do |doc|
        dst = dst_path doc
        puts &quot;#{doc.path} -&gt; #{dst}&quot;

        doc.save dst, {&quot;links&quot; =&gt; links}
      end
    end

</code></pre>
    </div>
</div>

<div id="section-4" class="grid">
    <div class="doc" id="section-4">
        <span class="anchor">
            <a href="#section-4" class="anchor">↦</a>
        </span>
        <p>Calculate destionation paths for the documents.
If the <code>as_source</code> option is set, the output should be a source
file, so it will have the language's extension and use the source
template.</p>
<p>If the source is literate (eg: <code>foo.yml.md</code>), the destination
will have the same name as the source but without the final &quot;.md&quot;</p>
<p>When the output is a document, &quot;.html&quot; is appended to the destination.</p>

    </div>
    <div class="code">
        <pre class="code"><code class="crystal">    def dst_path(doc : Document) : Path
      dst = (Path[@out_dir] / Path[doc.path].relative_to(@base_dir)).to_s
      dst += &quot;.html&quot; unless @as_source
      if doc.@literate &amp;&amp; File.extname(dst) == &quot;.md&quot;
        dst = dst[...-3]
      end
      Path[dst]
    end

</code></pre>
    </div>
</div>

<div id="section-5" class="grid">
    <div class="doc" id="section-5">
        <span class="anchor">
            <a href="#section-5" class="anchor">↦</a>
        </span>
        <p>Find the common prefix of the sources, this is used to preserve the
directory structure when saving the documents.</p>

    </div>
    <div class="code">
        <pre class="code"><code class="crystal">    def common_prefix : String
      sources = @docs.map &amp;.path
      candidate = Path[sources[0]].dirname
      until sources.all? { |source| Path[source].dirname.starts_with? candidate }
        candidate = Path[candidate].dirname
      end
      candidate
    end
  end
end

</code></pre>
    </div>
</div>


    </main>
    <footer style="text-align: center;" class="pico-background-purple-800">
        » Generated by <a href="https://crycco.ralsina.me">Crycco</a> » Layout 
sidebyside
 »
        Powered by <a href="https://picocss.com">PicoCSS</a> and <a href="https://www.omnibus-type.com/">Chivo Font
            Family</a>
    </footer>
    <script>
        hljs.highlightAll();
    </script>
</body>

</html>